<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>zkML News Oracle - ERC-8004 Demo</title>
    <style>
        :root {
            --bg-primary: #0a0e1a;
            --bg-secondary: #131821;
            --bg-tertiary: #1a1f2e;
            --text-primary: #ffffff;
            --text-secondary: #a0aec0;
            --accent-blue: #5b8cff;
            --accent-teal: #4de2cf;
            --accent-green: #10b981;
            --accent-red: #ef4444;
            --accent-yellow: #fbbf24;
            --border-color: #2d3748;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
        }

        /* Header */
        .header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 24px;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 24px;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .logo {
            font-size: 32px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-teal));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .badge {
            background: var(--bg-tertiary);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            color: var(--accent-teal);
            border: 1px solid var(--accent-teal);
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: var(--bg-tertiary);
            border-radius: 8px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--accent-green);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Main Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 48px;
            margin-bottom: 32px;
            text-align: center;
        }

        .hero h1 {
            font-size: 48px;
            margin-bottom: 16px;
            background: linear-gradient(135deg, var(--text-primary), var(--accent-teal));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero p {
            font-size: 20px;
            color: var(--text-secondary);
            margin-bottom: 32px;
        }

        .workflow {
            display: flex;
            justify-content: center;
            gap: 16px;
            flex-wrap: wrap;
            margin-top: 32px;
        }

        .workflow-step {
            background: var(--bg-primary);
            padding: 16px 24px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            min-width: 150px;
            position: relative;
        }

        .workflow-step.active {
            border-color: var(--accent-blue);
            box-shadow: 0 0 20px rgba(91, 140, 255, 0.3);
        }

        .workflow-step::after {
            content: '‚Üí';
            position: absolute;
            right: -24px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            font-size: 24px;
        }

        .workflow-step:last-child::after {
            display: none;
        }

        .step-number {
            font-size: 12px;
            color: var(--accent-teal);
            font-weight: 600;
            margin-bottom: 8px;
        }

        .step-title {
            font-size: 14px;
            font-weight: 600;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow);
        }

        .stat-label {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .stat-value.good {
            color: var(--accent-green);
        }

        .stat-value.bad {
            color: var(--accent-red);
        }

        .stat-value.neutral {
            color: var(--accent-yellow);
        }

        .stat-subtitle {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .dashboard-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .card-title {
            font-size: 20px;
            font-weight: 600;
        }

        .card-badge {
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
        }

        .card-badge.oracle {
            background: rgba(91, 140, 255, 0.2);
            color: var(--accent-blue);
        }

        .card-badge.agent {
            background: rgba(77, 226, 207, 0.2);
            color: var(--accent-teal);
        }

        .card-badge.registry {
            background: rgba(251, 191, 36, 0.2);
            color: var(--accent-yellow);
        }

        /* Classification List */
        .classification-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-height: 400px;
            overflow-y: auto;
        }

        .classification-item {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 16px;
            transition: all 0.2s;
        }

        .classification-item:hover {
            border-color: var(--accent-blue);
        }

        .classification-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .classification-headline {
            font-size: 14px;
            font-weight: 600;
            flex: 1;
            margin-right: 16px;
        }

        .sentiment-badge {
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            white-space: nowrap;
        }

        .sentiment-badge.good {
            background: rgba(16, 185, 129, 0.2);
            color: var(--accent-green);
        }

        .sentiment-badge.bad {
            background: rgba(239, 68, 68, 0.2);
            color: var(--accent-red);
        }

        .sentiment-badge.neutral {
            background: rgba(251, 191, 36, 0.2);
            color: var(--accent-yellow);
        }

        .classification-meta {
            display: flex;
            gap: 16px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .classification-meta span {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* Trade List */
        .trade-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-height: 400px;
            overflow-y: auto;
        }

        .trade-item {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 16px;
        }

        .trade-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .trade-action {
            font-size: 14px;
            font-weight: 600;
        }

        .trade-pnl {
            font-size: 16px;
            font-weight: 700;
        }

        .trade-pnl.positive {
            color: var(--accent-green);
        }

        .trade-pnl.negative {
            color: var(--accent-red);
        }

        .trade-pnl.pending {
            color: var(--text-secondary);
        }

        .trade-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Registry Table */
        .registry-table {
            width: 100%;
            border-collapse: collapse;
        }

        .registry-table th {
            text-align: left;
            padding: 12px;
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border-color);
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 600;
            text-transform: uppercase;
        }

        .registry-table td {
            padding: 12px;
            border-bottom: 1px solid var(--border-color);
            font-size: 14px;
        }

        .registry-table tr:hover {
            background: var(--bg-tertiary);
        }

        .reputation-bar {
            width: 100%;
            height: 8px;
            background: var(--bg-primary);
            border-radius: 4px;
            overflow: hidden;
        }

        .reputation-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-red), var(--accent-yellow), var(--accent-green));
            transition: width 0.3s;
        }

        /* Portfolio Card */
        .portfolio-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        .portfolio-item {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 16px;
        }

        .portfolio-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .portfolio-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent-teal);
        }

        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--accent-blue);
            color: white;
        }

        .btn-primary:hover {
            background: #4a7ae6;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(91, 140, 255, 0.4);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            border-color: var(--accent-teal);
            transform: translateY(-2px);
        }

        /* Loading Spinner */
        .spinner {
            width: 16px;
            height: 16px;
            border: 2px solid transparent;
            border-top-color: currentColor;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 48px 24px;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .workflow {
                flex-direction: column;
                align-items: center;
            }

            .workflow-step::after {
                content: '‚Üì';
                right: 50%;
                top: auto;
                bottom: -24px;
                transform: translateX(50%);
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-blue);
        }

        /* Info Tooltip */
        .info-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--bg-tertiary);
            color: var(--accent-blue);
            font-size: 12px;
            font-weight: 700;
            cursor: help;
            margin-left: 8px;
            border: 1px solid var(--border-color);
            position: relative;
            transition: all 0.2s;
        }

        .info-icon:hover {
            background: var(--accent-blue);
            color: white;
            border-color: var(--accent-blue);
            transform: scale(1.1);
        }

        .tooltip {
            position: absolute;
            bottom: calc(100% + 12px);
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-tertiary);
            border: 1px solid var(--accent-blue);
            border-radius: 8px;
            padding: 12px 16px;
            min-width: 280px;
            max-width: 400px;
            font-size: 13px;
            font-weight: 400;
            line-height: 1.5;
            color: var(--text-primary);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s, visibility 0.2s;
            pointer-events: none;
            white-space: normal;
        }

        .tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: var(--accent-blue);
        }

        .info-icon:hover .tooltip {
            opacity: 1;
            visibility: visible;
        }

        /* Proof Hash */
        .proof-hash {
            font-family: 'Courier New', monospace;
            font-size: 11px;
            color: var(--accent-teal);
            word-break: break-all;
        }

        /* Transaction Links - Prevent overflow */
        a[href*="basescan.org"] {
            word-break: break-all;
            overflow-wrap: break-word;
            display: inline-block;
            max-width: 100%;
        }

        /* zkML Proof Generation Banner */
        .proof-generation-banner {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, rgba(91, 140, 255, 0.95), rgba(77, 226, 207, 0.95));
            backdrop-filter: blur(10px);
            border: 2px solid var(--accent-teal);
            border-radius: 12px;
            padding: 16px 32px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
            align-items: center;
            gap: 16px;
            animation: slideDown 0.3s ease-out;
        }

        .proof-generation-banner.active {
            display: flex;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        .proof-spinner {
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        .proof-banner-text {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .proof-banner-title {
            font-size: 16px;
            font-weight: 700;
            color: white;
        }

        .proof-banner-subtitle {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.9);
        }

        .proof-timer {
            background: rgba(0, 0, 0, 0.3);
            padding: 8px 16px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            font-weight: 700;
            color: white;
            min-width: 80px;
            text-align: center;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo">zkML News Oracle</div>
                <span class="badge">ERC-8004 Demo</span>
            </div>
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span id="status-text">Live on Base Mainnet</span>
            </div>
        </div>
    </header>

    <!-- zkML Proof Generation Banner -->
    <div class="proof-generation-banner" id="proof-banner">
        <div class="proof-spinner"></div>
        <div class="proof-banner-text">
            <div class="proof-banner-title">Generating zkML Proof</div>
            <div class="proof-banner-subtitle">ONNX Inference ‚Üí JOLT Proof ‚Üí Groth16 Wrapper ‚Üí On-Chain</div>
        </div>
        <div class="proof-timer" id="proof-timer">0s</div>
    </div>

    <!-- Main Content -->
    <div class="container">
        <!-- Hero Section -->
        <section class="hero">
            <h1>Verifiable AI News Classification</h1>
            <p>zkML-powered sentiment analysis with on-chain proof verification and autonomous trading</p>

            <div class="workflow">
                <div class="workflow-step" id="step-1">
                    <div class="step-number">STEP 1</div>
                    <div class="step-title">Fetch News</div>
                </div>
                <div class="workflow-step" id="step-2">
                    <div class="step-number">STEP 2</div>
                    <div class="step-title">ML Classify</div>
                </div>
                <div class="workflow-step" id="step-3">
                    <div class="step-number">STEP 3</div>
                    <div class="step-title">Generate Proof</div>
                </div>
                <div class="workflow-step" id="step-4">
                    <div class="step-number">STEP 4</div>
                    <div class="step-title">Post On-Chain</div>
                </div>
                <div class="workflow-step" id="step-5">
                    <div class="step-number">STEP 5</div>
                    <div class="step-title">Agent Trades</div>
                </div>
            </div>
        </section>

        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- Oracle Dashboard -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h2 class="card-title">
                        üì∞ News Classifications
                        <span class="info-icon">‚ìò
                            <span class="tooltip">These are crypto news articles analyzed by our AI model. Each article is classified as Good News, Bad News, or Neutral using a real neural network. The AI's decision is cryptographically proven with zero-knowledge proofs and verified on the blockchain.</span>
                        </span>
                    </h2>
                    <span class="card-badge oracle">ORACLE</span>
                </div>
                <div class="classification-list" id="classification-list">
                    <div class="empty-state">
                        <div class="empty-state-icon">üìä</div>
                        <p>Loading classifications...</p>
                    </div>
                </div>
            </div>

            <!-- Trading Agent Dashboard -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h2 class="card-title">
                        üíº Agent Trades
                        <span class="info-icon">‚ìò
                            <span class="tooltip">This autonomous trading agent reads news classifications from the blockchain and automatically executes cryptocurrency trades. When it sees Good News, it buys ETH. When it sees Bad News, it sells ETH. All trades happen on-chain using real funds.</span>
                        </span>
                    </h2>
                    <span class="card-badge agent">AGENT</span>
                </div>
                <div class="trade-list" id="trade-list">
                    <div class="empty-state">
                        <div class="empty-state-icon">üíπ</div>
                        <p>Loading trades...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Portfolio and Registry -->
        <div class="dashboard-grid">
            <!-- Portfolio -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h2 class="card-title">
                        üí∞ Agent Portfolio
                        <span class="info-icon">‚ìò
                            <span class="tooltip">This shows the trading agent's current cryptocurrency holdings. The agent holds ETH (Ethereum) and USDC (US Dollar Coin) in its wallet. These are real tokens on Base blockchain that the agent trades automatically based on news sentiment.</span>
                        </span>
                    </h2>
                    <span class="card-badge agent">LIVE</span>
                </div>
                <div style="margin-bottom: 16px; padding: 12px; background: var(--bg-tertiary); border-radius: 8px; border: 1px solid var(--border-color);">
                    <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 8px;">üíº Agent Wallet Address</div>
                    <a href="https://basescan.org/address/0xBC2a8f872f02CCd2356F235675f756A4FdCAd81d" target="_blank" style="text-decoration: none;">
                        <div class="proof-hash" style="color: var(--accent-blue); cursor: pointer; transition: color 0.2s;" onmouseover="this.style.color='var(--accent-teal)'" onmouseout="this.style.color='var(--accent-blue)'">0xBC2a8f872f02CCd2356F235675f756A4FdCAd81d</div>
                    </a>
                </div>
                <div class="portfolio-grid" id="portfolio-grid">
                    <div class="portfolio-item">
                        <div class="portfolio-label">ETH Balance</div>
                        <div class="portfolio-value" id="weth-balance">-</div>
                    </div>
                    <div class="portfolio-item">
                        <div class="portfolio-label">USDC Balance</div>
                        <div class="portfolio-value" id="usdc-balance">-</div>
                    </div>
                    <div class="portfolio-item">
                        <div class="portfolio-label">Total Value</div>
                        <div class="portfolio-value" id="total-value">-</div>
                    </div>
                    <div class="portfolio-item">
                        <div class="portfolio-label">P&L (24h)</div>
                        <div class="portfolio-value" id="pnl-24h">-</div>
                    </div>
                </div>
            </div>

            <!-- ERC-8004 Registry -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h2 class="card-title">
                        üèõÔ∏è ERC-8004 Registry
                        <span class="info-icon">‚ìò
                            <span class="tooltip">ERC-8004 is a blockchain standard for AI agent identities and work validation. This registry tracks which AI agents are registered on the network, monitors their reputation scores, and coordinates validation requests between agents. Think of it as a trust system for AI work.</span>
                        </span>
                    </h2>
                    <span class="card-badge registry">REGISTRY</span>
                </div>
                <div style="margin-bottom: 16px; padding: 12px; background: var(--bg-tertiary); border-radius: 8px; border: 1px solid var(--border-color);">
                    <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 8px;">üèõÔ∏è ValidationRegistry Contract Address</div>
                    <a href="https://basescan.org/address/0x44fBb986C8705A1de9951131a48D8eBc142c08E6" target="_blank" style="text-decoration: none;">
                        <div class="proof-hash" id="validation-registry-address" style="color: var(--accent-blue); cursor: pointer; transition: color 0.2s;" onmouseover="this.style.color='var(--accent-teal)'" onmouseout="this.style.color='var(--accent-blue)'">0x44fBb986C8705A1de9951131a48D8eBc142c08E6</div>
                    </a>
                </div>
                <div style="margin-bottom: 20px;">
                    <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 12px; color: var(--text-primary);">
                        Registered Agents
                        <span class="info-icon">‚ìò
                            <span class="tooltip">Each AI agent on the network gets a unique NFT (token) as its identity. Agents earn reputation points (0-1000) by completing accurate work. Higher reputation means more trustworthy AI. Our news classifier Oracle has Token ID #1.</span>
                        </span>
                    </h3>
                    <table class="registry-table">
                        <thead>
                            <tr>
                                <th>Token ID</th>
                                <th>Capability</th>
                                <th>Reputation</th>
                            </tr>
                        </thead>
                        <tbody id="registry-tbody">
                            <tr>
                                <td colspan="3">
                                    <div class="empty-state">
                                        <div class="empty-state-icon">üîê</div>
                                        <p>Loading registry...</p>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div style="margin-bottom: 16px;">
                    <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 12px; color: var(--text-primary);">
                        Recent Validation Requests
                        <span class="info-icon">‚ìò
                            <span class="tooltip">When our Oracle AI classifies news, it creates a validation request asking other AI agents to verify the work. This table shows pending, approved, or rejected validations. Other agents can validate the Oracle's work to build trust in the network.</span>
                        </span>
                    </h3>
                    <table class="registry-table">
                        <thead>
                            <tr>
                                <th>Classification ID</th>
                                <th>Agent Token</th>
                                <th>Status</th>
                                <th>Responses</th>
                                <th>Request Time</th>
                            </tr>
                        </thead>
                        <tbody id="validations-tbody">
                            <tr>
                                <td colspan="5">
                                    <div class="empty-state">
                                        <div class="empty-state-icon">‚è≥</div>
                                        <p>Loading validation history...</p>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid" id="stats-grid" style="margin-bottom: 32px;">
            <div class="stat-card">
                <div class="stat-label">üîê Oracle Reputation</div>
                <div class="stat-value" id="oracle-reputation">-</div>
                <div class="stat-subtitle">ERC-8004 Trust Score</div>
                <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border-color); display: flex; justify-content: space-between; font-size: 12px; color: var(--text-secondary);">
                    <span id="oracle-proofs">- proofs</span>
                    <span id="oracle-accuracy">-% accurate</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total Trades</div>
                <div class="stat-value" id="total-trades">-</div>
                <div class="stat-subtitle">Autonomous executions</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Win Rate</div>
                <div class="stat-value good" id="win-rate">-</div>
                <div class="stat-subtitle">10-second profitability</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total Classifications</div>
                <div class="stat-value" id="total-classifications">-</div>
                <div class="stat-subtitle">All-time on Base</div>
            </div>
        </div>

        <!-- Contract Addresses -->
        <div class="dashboard-card">
            <div class="card-header">
                <h2 class="card-title">
                    üìã Contract Addresses
                    <span class="info-icon">‚ìò
                        <span class="tooltip">These are the blockchain addresses of all smart contracts powering this system. Each address is on Base Mainnet. Click any address to view it on BaseScan, the blockchain explorer. All code is transparent and verifiable on-chain.</span>
                    </span>
                </h2>
                <span class="card-badge registry">BASE</span>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 16px;">
                <div class="portfolio-item">
                    <div class="portfolio-label">üì∞ News Oracle</div>
                    <a href="https://basescan.org/address/0x93Efb961780a19052A2fBd186A86b7edf073EFb6" target="_blank" style="text-decoration: none;">
                        <div class="proof-hash" id="oracle-address" style="color: var(--accent-blue); cursor: pointer; transition: color 0.2s;" onmouseover="this.style.color='var(--accent-teal)'" onmouseout="this.style.color='var(--accent-blue)'">0x93Efb961780a19052A2fBd186A86b7edf073EFb6</div>
                    </a>
                </div>
                <div class="portfolio-item">
                    <div class="portfolio-label">üíº Trading Agent</div>
                    <a href="https://basescan.org/address/0xBC2a8f872f02CCd2356F235675f756A4FdCAd81d" target="_blank" style="text-decoration: none;">
                        <div class="proof-hash" id="agent-address" style="color: var(--accent-blue); cursor: pointer; transition: color 0.2s;" onmouseover="this.style.color='var(--accent-teal)'" onmouseout="this.style.color='var(--accent-blue)'">0xBC2a8f872f02CCd2356F235675f756A4FdCAd81d</div>
                    </a>
                </div>
                <div class="portfolio-item">
                    <div class="portfolio-label">üîê Groth16 Verifier</div>
                    <a href="https://basescan.org/address/0x80DA3C348D132172A21868cb318874b20FE1F177" target="_blank" style="text-decoration: none;">
                        <div class="proof-hash" style="color: var(--accent-blue); cursor: pointer; transition: color 0.2s;" onmouseover="this.style.color='var(--accent-teal)'" onmouseout="this.style.color='var(--accent-blue)'">0x80DA3C348D132172A21868cb318874b20FE1F177</div>
                    </a>
                </div>
                <div class="portfolio-item">
                    <div class="portfolio-label">‚úÖ News Verifier</div>
                    <a href="https://basescan.org/address/0x42706c5d80CC618e51d178bd9869894692A77a5c" target="_blank" style="text-decoration: none;">
                        <div class="proof-hash" style="color: var(--accent-blue); cursor: pointer; transition: color 0.2s;" onmouseover="this.style.color='var(--accent-teal)'" onmouseout="this.style.color='var(--accent-blue)'">0x42706c5d80CC618e51d178bd9869894692A77a5c</div>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API Base URL
        const API_URL = 'http://localhost:3001';

        // Auto-refresh interval (10 seconds)
        const REFRESH_INTERVAL = 10000;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ zkML News Oracle UI initialized');
            loadDashboard();
            startAutoRefresh();
        });

        // Load all dashboard data
        async function loadDashboard() {
            try {
                await Promise.all([
                    loadStats(),
                    loadClassifications(),
                    loadTrades(),
                    loadPortfolio(),
                    loadRegistry(),
                    loadValidations()
                ]);
            } catch (error) {
                console.error('Error loading dashboard:', error);
            }
        }

        // Load latest classification
        async function loadLatestClassification() {
            try {
                const response = await fetch(`${API_URL}/api/latest-classification`);
                const data = await response.json();

                const card = document.getElementById('latest-classification-card');
                const contentEl = document.getElementById('latest-classification-content');

                if (!data.classification) {
                    card.style.display = 'none';
                    return;
                }

                card.style.display = 'block';
                const c = data.classification;
                const zkmlBadge = c.isZkmlVerified
                    ? '<span style="color: var(--accent-green); font-weight: 600; margin-left: 12px;">‚úì zkML Verified</span>'
                    : '<span style="color: var(--accent-yellow); font-weight: 600; margin-left: 12px;">‚è≥ Verification Pending</span>';

                contentEl.innerHTML = `
                    <div style="background: var(--bg-tertiary); border: 2px solid var(--accent-blue); border-radius: 12px; padding: 24px;">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px;">
                            <div style="flex: 1;">
                                <div style="font-size: 18px; font-weight: 700; margin-bottom: 8px; color: var(--text-primary);">
                                    ${c.headline}
                                    ${zkmlBadge}
                                </div>
                                <div style="display: flex; gap: 24px; flex-wrap: wrap; margin-top: 16px;">
                                    <div>
                                        <div style="font-size: 11px; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 4px;">Sentiment</div>
                                        <span class="sentiment-badge ${c.sentiment.toLowerCase()}" style="font-size: 14px; padding: 6px 16px;">${c.sentiment}</span>
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 4px;">Confidence</div>
                                        <div style="font-size: 18px; font-weight: 700; color: var(--accent-teal);">${c.confidence}%</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 4px;">Oracle Token</div>
                                        <div style="font-size: 18px; font-weight: 700;">#${c.oracleTokenId}</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 4px;">Timestamp</div>
                                        <div style="font-size: 14px;">${new Date(c.timestamp * 1000).toLocaleString()}</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 16px; margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border-color);">
                            <div style="background: var(--bg-primary); padding: 16px; border-radius: 8px;">
                                <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 8px;">üîê Proof Hash</div>
                                <div class="proof-hash" style="color: var(--accent-teal);">${c.proofHash}</div>
                            </div>
                            <div style="background: var(--bg-primary); padding: 16px; border-radius: 8px;">
                                <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 8px;">üìù Classification TX</div>
                                <a href="${c.explorerUrl}" target="_blank" style="color: var(--accent-blue); text-decoration: none; font-family: 'Courier New', monospace; font-size: 12px; display: flex; align-items: center; gap: 6px;">
                                    ${c.txHash}
                                    <span style="font-size: 14px;">‚Üó</span>
                                </a>
                            </div>
                            ${c.verificationTxHash ? `
                                <div style="background: var(--bg-primary); padding: 16px; border-radius: 8px;">
                                    <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 8px;">‚úÖ Verification TX</div>
                                    <a href="${c.verificationExplorerUrl}" target="_blank" style="color: var(--accent-blue); text-decoration: none; font-family: 'Courier New', monospace; font-size: 12px; display: flex; align-items: center; gap: 6px;">
                                        ${c.verificationTxHash}
                                        <span style="font-size: 14px;">‚Üó</span>
                                    </a>
                                </div>
                            ` : ''}
                        </div>

                        <div style="margin-top: 16px; padding: 12px; background: rgba(91, 140, 255, 0.1); border-radius: 8px; border-left: 4px solid var(--accent-blue);">
                            <div style="font-size: 12px; color: var(--text-secondary);">
                                ‚ÑπÔ∏è This classification was generated using <strong>real ONNX neural network</strong> inference, proven with <strong>JOLT zkML proof</strong> (~20s), wrapped in <strong>Groth16 zkSNARK</strong> (~1.5s), and verified on-chain at Base Mainnet.
                            </div>
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading latest classification:', error);
                document.getElementById('latest-classification-card').style.display = 'none';
            }
        }

        // Load statistics
        async function loadStats() {
            try {
                const response = await fetch(`${API_URL}/api/stats`);
                const data = await response.json();

                document.getElementById('total-classifications').textContent = data.totalClassifications || '0';

                // Oracle reputation with verification stats
                const oracleReputation = data.oracleReputation || '0';
                const oracleProofs = data.oracleProofsSubmitted || '0';
                const oracleAccuracy = data.oracleAccuracy || '0';

                document.getElementById('oracle-reputation').textContent = `${oracleReputation}/1000`;
                document.getElementById('oracle-proofs').textContent = `${oracleProofs} proofs`;
                document.getElementById('oracle-accuracy').textContent = oracleAccuracy > 0 ? `${oracleAccuracy}% accurate` : 'N/A';

                document.getElementById('total-trades').textContent = data.totalTrades || '0';
                document.getElementById('win-rate').textContent = `${data.winRate || '0'}%`;
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // Load classifications
        async function loadClassifications() {
            try {
                const response = await fetch(`${API_URL}/api/classifications`);
                const data = await response.json();

                const listEl = document.getElementById('classification-list');

                if (!data.classifications || data.classifications.length === 0) {
                    listEl.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìä</div><p>No classifications yet</p></div>';
                    return;
                }

                listEl.innerHTML = data.classifications.map(c => {
                    const zkmlBadge = c.isZkmlVerified
                        ? '<span style="color: var(--accent-green); font-size: 11px; margin-left: 8px;">‚úì zkML</span>'
                        : '';

                    return `
                    <div class="classification-item">
                        <div class="classification-header">
                            <div class="classification-headline">${c.headline}${zkmlBadge}</div>
                            <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 4px;">
                                <span class="sentiment-badge ${c.sentiment.toLowerCase()}">${c.sentiment}</span>
                                <span style="font-size: 11px; color: var(--text-secondary); font-weight: 600;">${c.confidence}% confidence</span>
                            </div>
                        </div>
                        <div class="classification-meta">
                            <span>üîê Proof: ${c.proofHash.slice(0, 10)}...</span>
                            <span>‚è∞ ${new Date(c.timestamp * 1000).toLocaleString()}</span>
                        </div>
                        <div style="margin-top: 8px;">
                            <a href="${c.explorerUrl}" target="_blank" style="color: var(--accent-blue); text-decoration: none; font-size: 12px; display: inline-flex; align-items: center; gap: 4px;">
                                üîó View on BaseScan
                                <span style="font-family: 'Courier New', monospace;">${c.txHash ? c.txHash.slice(0, 10) + '...' : ''}</span>
                            </a>
                        </div>
                    </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error loading classifications:', error);
            }
        }

        // Load trades
        async function loadTrades() {
            try {
                const response = await fetch(`${API_URL}/api/trades`);
                const data = await response.json();

                const listEl = document.getElementById('trade-list');

                if (!data.trades || data.trades.length === 0) {
                    listEl.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üíπ</div><p>No trades yet</p></div>';
                    return;
                }

                listEl.innerHTML = data.trades.map(t => {
                    const pnlClass = t.isProfitable ? 'positive' : (t.portfolioValueAfter > 0 ? 'negative' : 'pending');
                    const pnlText = t.portfolioValueAfter > 0
                        ? (t.isProfitable ? `+${t.profitPercent}%` : `${t.profitPercent}%`)
                        : 'Pending Evaluation';

                    // Make action human-readable
                    let actionText = t.action;
                    let actionEmoji = 'üí±';
                    if (t.action.includes('SELL_ETH') || t.action.includes('ETH') && t.action.includes('SELL')) {
                        actionText = `Sold ${t.amountIn} ETH ‚Üí ${t.amountOut} USDC`;
                        actionEmoji = 'üìâ';
                    } else if (t.action.includes('BUY_ETH') || t.action.includes('ETH') && t.action.includes('BUY')) {
                        actionText = `Bought ${t.amountOut} ETH ‚Üê ${t.amountIn} USDC`;
                        actionEmoji = 'üìà';
                    } else if (t.action.includes('HOLD')) {
                        actionText = 'Hold Position';
                        actionEmoji = '‚è∏Ô∏è';
                    }

                    return `
                        <div class="trade-item">
                            <div class="trade-header">
                                <div class="trade-action">${actionEmoji} ${actionText}</div>
                                <div class="trade-pnl ${pnlClass}">${pnlText}</div>
                            </div>
                            <div class="trade-details">
                                <div>üìä Sentiment: ${t.sentiment}</div>
                                <div>‚è∞ ${new Date(t.timestamp * 1000).toLocaleString()}</div>
                                <div>üíº Value Before: $${t.portfolioValueBefore}</div>
                                <div>üíº Value After: $${t.portfolioValueAfter > 0 ? t.portfolioValueAfter : 'Pending'}</div>
                            </div>
                            ${t.txHash && t.txHash !== '0x' ? `
                                <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border-color);">
                                    <a href="${t.explorerUrl}" target="_blank" style="color: var(--accent-blue); text-decoration: none; font-size: 12px; display: inline-flex; align-items: center; gap: 4px;">
                                        üîó View on BaseScan
                                        <span style="font-family: 'Courier New', monospace;">${t.txHash.slice(0, 10)}...</span>
                                    </a>
                                </div>
                            ` : ''}
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error loading trades:', error);
            }
        }

        // Load portfolio
        async function loadPortfolio() {
            try {
                const response = await fetch(`${API_URL}/api/portfolio`);
                const data = await response.json();

                document.getElementById('weth-balance').textContent = `${data.wethBalance || '0'} ETH`;
                document.getElementById('usdc-balance').textContent = `${data.usdcBalance || '0'} USDC`;
                document.getElementById('total-value').textContent = `$${data.totalValue || '0'}`;
                document.getElementById('pnl-24h').textContent = data.pnl24h ? `${data.pnl24h > 0 ? '+' : ''}${data.pnl24h}%` : '-';
            } catch (error) {
                console.error('Error loading portfolio:', error);
            }
        }

        // Load registry
        async function loadRegistry() {
            try {
                const response = await fetch(`${API_URL}/api/registry`);
                const data = await response.json();

                const tbody = document.getElementById('registry-tbody');

                if (!data.agents || data.agents.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="3"><div class="empty-state"><div class="empty-state-icon">üîê</div><p>No agents registered</p></div></td></tr>';
                    return;
                }

                tbody.innerHTML = data.agents.map(a => `
                    <tr>
                        <td>
                            <a href="https://basescan.org/token/0x98879bE272B30844D3d3BBcDD849827b524F43B5?a=${a.tokenId}" target="_blank" style="color: var(--accent-blue); text-decoration: none; font-weight: 600;" onmouseover="this.style.color='var(--accent-teal)'" onmouseout="this.style.color='var(--accent-blue)'">
                                #${a.tokenId}
                            </a>
                        </td>
                        <td>${a.capability}</td>
                        <td>
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <span>${a.reputation}/1000</span>
                                <div class="reputation-bar" style="flex: 1;">
                                    <div class="reputation-fill" style="width: ${(a.reputation / 1000) * 100}%"></div>
                                </div>
                            </div>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading registry:', error);
            }
        }

        // Load validations
        async function loadValidations() {
            try {
                const response = await fetch(`${API_URL}/api/validations`);
                const data = await response.json();

                const tbody = document.getElementById('validations-tbody');

                if (!data.validations || data.validations.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5"><div class="empty-state"><div class="empty-state-icon">üì≠</div><p>No validation requests yet</p></div></td></tr>';
                    return;
                }

                tbody.innerHTML = data.validations.map(v => {
                    const statusLabels = ['Pending', 'Validated', 'Rejected'];
                    const statusColors = ['var(--accent-yellow)', 'var(--accent-green)', 'var(--accent-red)'];
                    const statusIcons = ['‚è≥', '‚úÖ', '‚ùå'];

                    const status = statusLabels[v.status] || 'Unknown';
                    const color = statusColors[v.status] || 'var(--text-secondary)';
                    const icon = statusIcons[v.status] || '‚ùì';

                    const shortId = v.classificationId.substring(0, 10) + '...' + v.classificationId.substring(v.classificationId.length - 8);
                    const timeAgo = formatTimeAgo(v.requestTime);

                    return `
                    <tr>
                        <td>
                            <div style="font-family: monospace; font-size: 12px;">${shortId}</div>
                        </td>
                        <td>#${v.agentTokenId}</td>
                        <td>
                            <span style="color: ${color};">${icon} ${status}</span>
                        </td>
                        <td>${v.responseCount}</td>
                        <td>${timeAgo}</td>
                    </tr>
                `;
                }).join('');
            } catch (error) {
                console.error('Error loading validations:', error);
                const tbody = document.getElementById('validations-tbody');
                tbody.innerHTML = '<tr><td colspan="5"><div class="empty-state"><div class="empty-state-icon">‚ö†Ô∏è</div><p>Error loading validations</p></div></td></tr>';
            }
        }

        // Helper function to format time ago
        function formatTimeAgo(timestamp) {
            const now = Math.floor(Date.now() / 1000);
            const seconds = now - timestamp;

            if (seconds < 60) return `${seconds}s ago`;
            if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;
            if (seconds < 86400) return `${Math.floor(seconds / 3600)}h ago`;
            return `${Math.floor(seconds / 86400)}d ago`;
        }

        // Start auto-refresh
        function startAutoRefresh() {
            setInterval(loadDashboard, REFRESH_INTERVAL);
        }

        // Animate workflow steps
        function animateWorkflow() {
            const steps = ['step-1', 'step-2', 'step-3', 'step-4', 'step-5'];
            let currentStep = 0;

            setInterval(() => {
                steps.forEach(id => document.getElementById(id).classList.remove('active'));
                document.getElementById(steps[currentStep]).classList.add('active');
                currentStep = (currentStep + 1) % steps.length;
            }, 2000);
        }

        animateWorkflow();

        // Proof Generation Banner Management
        let proofStartTime = null;
        let proofTimerInterval = null;
        let lastClassificationCount = 0;

        async function checkProofGeneration() {
            try {
                const response = await fetch(`${API_URL}/api/stats`);
                const data = await response.json();
                const currentCount = parseInt(data.totalClassifications) || 0;

                // If classification count increased, a proof just completed
                if (currentCount > lastClassificationCount) {
                    hideProofBanner();
                    lastClassificationCount = currentCount;
                }
            } catch (error) {
                console.error('Error checking proof generation:', error);
            }
        }

        function showProofBanner() {
            const banner = document.getElementById('proof-banner');
            if (!banner.classList.contains('active')) {
                banner.classList.add('active');
                proofStartTime = Date.now();

                // Start timer
                if (proofTimerInterval) clearInterval(proofTimerInterval);
                proofTimerInterval = setInterval(updateProofTimer, 100);
            }
        }

        function hideProofBanner() {
            const banner = document.getElementById('proof-banner');
            banner.classList.remove('active');

            if (proofTimerInterval) {
                clearInterval(proofTimerInterval);
                proofTimerInterval = null;
            }
            proofStartTime = null;
        }

        function updateProofTimer() {
            if (!proofStartTime) return;

            const elapsed = Math.floor((Date.now() - proofStartTime) / 1000);
            const timerEl = document.getElementById('proof-timer');
            timerEl.textContent = `${elapsed}s`;

            // Auto-hide after 60 seconds (proof likely failed or completed elsewhere)
            if (elapsed > 60) {
                hideProofBanner();
            }
        }

        // Simulated demo: Show proof banner periodically to demonstrate the feature
        // In production, this would be triggered by backend events
        function startProofDemo() {
            // Show banner for 25 seconds every 5 minutes to demonstrate
            setInterval(() => {
                showProofBanner();
                setTimeout(() => {
                    hideProofBanner();
                    // Trigger dashboard reload to show new data
                    loadDashboard();
                }, 25000); // 25 seconds (typical proof generation time)
            }, 300000); // Every 5 minutes
        }

        // Check for proof generation status periodically
        setInterval(checkProofGeneration, 5000);

        // Initialize proof generation tracking
        (async () => {
            try {
                const response = await fetch(`${API_URL}/api/stats`);
                const data = await response.json();
                lastClassificationCount = parseInt(data.totalClassifications) || 0;
            } catch (error) {
                console.error('Error initializing proof tracking:', error);
            }
        })();

        // Note: In production, the backend would emit events when proof generation starts
        // For now, users can manually trigger by visiting the service
    </script>
</body>
</html>
