services:
  # zkML Combined Service (News Service + UI Frontend)
  - type: web
    name: trustlessdefi
    env: node
    region: oregon
    plan: starter
    buildCommand: cd news-service && npm install && cd ../ui && npm install
    startCommand: bash start-combined.sh
    healthCheckPath: /api/health
    envVars:
      # Blockchain Configuration (Base Mainnet)
      - key: BASE_MAINNET_RPC_URL
        sync: false
      - key: ORACLE_PRIVATE_KEY
        sync: false

      # Contract Addresses (Base Mainnet - Updated 2025-10-25)
      - key: NEWS_ORACLE_CONTRACT_ADDRESS
        value: 0xfe47ba256043617f4acaF0c74Af25ba95be61b95
      - key: NEWS_ORACLE_ADDRESS
        value: 0xfe47ba256043617f4acaF0c74Af25ba95be61b95
      - key: VERIFICATION_REGISTRY_ADDRESS
        value: 0x0D5F44E626E56b928c273460C73bfe724aef977A
      - key: ZKML_VERIFICATION_REGISTRY
        value: 0x0D5F44E626E56b928c273460C73bfe724aef977A
      - key: VALIDATION_REGISTRY_ADDRESS
        value: 0x0f556d976FA29f0BF678e2367F5E99fa1261f93e
      - key: VALIDATION_REGISTRY
        value: 0x0f556d976FA29f0BF678e2367F5E99fa1261f93e
      - key: TRADING_AGENT_ADDRESS
        value: 0xA03cAdb9cfA3CD8048172f1C127706a9B7C88782
      - key: NEWS_VERIFIER_ADDRESS
        value: 0xb4c9f9fDEBeD2cB8350E9165Dbd319b14e7cE1Af
      - key: GROTH16_VERIFIER
        value: 0x8dEd762207A6493b229Ccd832E1445B51522807e
      - key: ORACLE_TOKEN_ID
        value: 1

      # Uniswap V3 (Base Mainnet)
      - key: UNISWAP_V3_ROUTER
        value: 0x2626664c2603336E57B271c5C0b26F421741e481
      - key: WETH_ADDRESS
        value: 0x4200000000000000000000000000000000000006
      - key: USDC_ADDRESS
        value: 0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913

      # News Sources
      - key: COINDESK_RSS_URL
        value: https://www.coindesk.com/arc/outboundfeeds/rss/
      - key: CRYPTOCOMPARE_API_KEY
        value: ""

      # Service Configuration
      - key: POLL_INTERVAL_MINUTES
        value: 5
      - key: MIN_CONFIDENCE_THRESHOLD
        value: 60
      - key: MAX_CLASSIFICATIONS_PER_CYCLE
        value: 5

      # JOLT-Atlas Configuration
      - key: JOLT_ATLAS_PATH
        value: ../zkml-model
      - key: PROOF_TIMEOUT_MS
        value: 5000

      # Logging
      - key: LOG_LEVEL
        value: info

      # Trading Configuration
      - key: ENABLE_AUTO_TRADE
        value: "true"

      # zkML Proof Configuration
      - key: USE_REAL_PROOFS
        value: "true"

      # Node Environment
      - key: NODE_ENV
        value: production

      # UI Service Configuration
      - key: NEWS_SERVICE_URL
        value: http://localhost:3000
      - key: ALLOWED_ORIGINS
        value: https://trustlessdefi.onrender.com

  # BaseTrader Service (Optional - can run as background worker)
  - type: worker
    name: zkml-base-trader
    env: node
    region: oregon
    plan: starter
    buildCommand: cd news-service && npm install
    startCommand: cd news-service && node src/startBaseTrader.js
    envVars:
      # Same env vars as news-service (Updated 2025-10-25)
      - key: BASE_MAINNET_RPC_URL
        sync: false
      - key: ORACLE_PRIVATE_KEY
        sync: false
      - key: NEWS_ORACLE_CONTRACT_ADDRESS
        value: 0xfe47ba256043617f4acaF0c74Af25ba95be61b95
      - key: VERIFICATION_REGISTRY_ADDRESS
        value: 0x0D5F44E626E56b928c273460C73bfe724aef977A
      - key: TRADING_AGENT_ADDRESS
        value: 0xA03cAdb9cfA3CD8048172f1C127706a9B7C88782
      - key: UNISWAP_V3_ROUTER
        value: 0x2626664c2603336E57B271c5C0b26F421741e481
      - key: WETH_ADDRESS
        value: 0x4200000000000000000000000000000000000006
      - key: USDC_ADDRESS
        value: 0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913
      - key: LOG_LEVEL
        value: info
      - key: NODE_ENV
        value: production
